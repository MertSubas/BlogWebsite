@model AdminAboutViewModel
@{
    ViewData["Title"] = "AboutIndex";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="col-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title"> HAKKINDA</h4>
            <br />
            <form class="forms-sample">
                <div class="form-group">
                    <label>Resim Yükle</label>
                    <input   type="file" name="img[]" id="fileInput" class="file-upload-default" onchange="previewImage()">
                    <div id="imagePreview" class="mt-2">
                        <img id="preview" src=@Model.AboutImage alt="Resim Önizleme" style="max-width: 200px; max-height: 200px;">
                    </div>
                    <br />
                    <div class="input-group col-xs-12">
                        <input asp-for="AboutImage" id="blogImage" type="text" class="form-control file-upload-info" disabled placeholder="Resim Yükle">
                        <span class="input-group-append">
                            <button class="file-upload-browse btn btn-gradient-primary" type="button" onclick="document.getElementById('fileInput').click()">Yükle</button>
                        </span>
                    </div>

                </div>

                <div class="form-group">
                    <label for="aboutTitle">Hakkında Başlığı</label>
                    <input asp-for="AboutTitle" type="text" class="form-control" id="aboutTitle" placeholder="Hakkında Başlık">
                </div>


                <div class="form-group">
                    <label for="aboutContent">Hakkımda</label>
                    <textarea asp-for="AboutContent" class="form-control" id="aboutContent" name="aboutContent" rows="4" ></textarea>
                </div>

                <input type="button" class="btn btn-gradient-primary mr-2" id="btnAboutSubmit" value="Kaydet" />
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-ajax-unobtrusive/3.2.6/jquery.unobtrusive-ajax.min.js"></script>
    <script>
        CKEDITOR.replace('aboutContent');
        @*Kaydet İşlemi Start*@
            
            $(document).ready(function () {
               
                $('#btnAboutSubmit').click(function () {
                    var fileInput = document.getElementById('fileInput');
                    var file = fileInput.files[0];
                    var formData = new FormData();
                    if (file) {
                        formData.append('file', file);

                        $.ajax({
                            type: "POST",
                            url: "/Admin/About/UploadImage",
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function (imagePath) {
                                    handleBlogPost(imagePath);
                            },
                            error: function (error) {
                                alert("Fotoğraf yüklenirken bir hata oluştu.");
                            }
                        });
                    } else {
                        handleBlogPost(null);
                    }
                });

                function handleBlogPost(imagePath) {
                    var AboutContent = CKEDITOR.instances.aboutContent.getData();
                    var postData = {
                        AboutId:1,
                        AboutTitle: $('#aboutTitle').val(),
                        AboutContent: AboutContent,
                        AboutImage: imagePath,
                        AbountSubTitle:null,
                        AbountSubContent:null,
                    };
                    console.log(postData);
                    $.ajax({
                        type: "POST",
                        url: "/Admin/About/AddAbout",
                        data: JSON.stringify(postData),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (response) {
                            Swal.fire({
                                icon: 'success',
                                title: 'Başarılı',
                                text: 'Kayıt Başarıyla Eklendi!',
                                timer: 3000,
                                showConfirmButton: false
                            });
                            location.reload();
                        },
                        error: function (error) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Hata',
                                text: 'Bir Hata Oluştu Tekrar Deneyiniz!',
                                timer: 3000,
                                showConfirmButton: false
                            });
                        }
                    });
                }
            });
        @*Kaydet İşlemi End*@

        
        function previewImage() {
            // Dosya adını al ve göster
            var fileName = document.getElementById('fileInput').value.split("\\").pop();
            document.getElementById('fileName').innerHTML = fileName;

            // Resim önizlemesini göster
            document.getElementById('imagePreview').style.display = 'block';

            // Dosya giriş alanını gizle ve temizle
            document.getElementById('fileInput').style.display = 'none';
            document.getElementById('fileInput').value = "";
        }

    
        @*Resim Alanın da Fotoğrafı gösterme*@
            function previewImage() {
                var fileInput = document.getElementById('fileInput');
                var preview = document.getElementById('preview');
                var imagePreview = document.getElementById('imagePreview');

                if (fileInput.files && fileInput.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    };

                    reader.readAsDataURL(fileInput.files[0]);
                } else {
                    preview.src = '';
                    imagePreview.style.display = 'none';
                }
            }
        @*Resim Alanın da Fotoğrafı gösterme*@

        @*Resim önizleme fonksiyonu*@
            function showImagePreview(imagePath) {
                var imagePreview = document.getElementById('imagePreview');
                var blogImageInput = document.getElementById('blogImage');

                if (imagePath) {
                    // Resim varsa önizleme alanını göster
                    imagePreview.style.display = 'block';
                    // Resmi görüntüle
                    $('#preview').attr('src', imagePath);
                    // Resim yolu bilgisini input alanına yaz
                    blogImageInput.value = imagePath;
                } else {
                    // Resim yoksa önizleme alanını gizle
                    imagePreview.style.display = 'none';
                    // Input alanını temizle
                    blogImageInput.value = '';
                }
            }
        @*Resim önizleme fonksiyonu End*@

    </script>


}